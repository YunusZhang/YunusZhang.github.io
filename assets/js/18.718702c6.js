(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{325:function(t,s,e){"use strict";e.r(s);var n=e(1),a=Object(n.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),e("p",[t._v("一个常见目标是,不仅要增加注册量,还要优化用户可能选择的注册方案, 比如,一个业务体可能希望用户在多种备选项中,选择价格更高的方案.")]),t._v(" "),e("p",[t._v("假设给用户展示两个版本的定价页面,并且希望得到每次访问的收入期望值.之前AB测试只关心用户是否注册了, 此时我们想要知道能获得的收入期望值.")]),t._v(" "),t._m(1),t._v(" "),e("p",[t._v("暂时不考虑AB测试,假设要分析的是单一的网页风格. 如果整个世界是透明的,一切都是已知量, 那么可以通过以下公式为这一虚构的企业计算收入的期望值.")]),t._v(" "),e("p",[e("span",{staticClass:"katex-display"},[e("span",{staticClass:"katex"},[e("span",{staticClass:"katex-mathml"},[e("math",[e("semantics",[e("mrow",[e("mi",[t._v("E")]),e("mo",[t._v("[")]),e("mi",[t._v("R")]),e("mo",[t._v("]")]),e("mo",[t._v("=")]),e("mn",[t._v("7")]),e("msub",[e("mn",[t._v("9")]),e("mi",[t._v("P")])],1),e("mn",[t._v("7")]),e("mn",[t._v("9")]),e("mo",[t._v("+")]),e("mn",[t._v("4")]),e("msub",[e("mn",[t._v("9")]),e("mi",[t._v("P")])],1),e("mn",[t._v("4")]),e("mn",[t._v("9")]),e("mo",[t._v("+")]),e("mn",[t._v("2")]),e("msub",[e("mn",[t._v("5")]),e("mi",[t._v("P")])],1),e("mn",[t._v("2")]),e("mn",[t._v("5")]),e("mo",[t._v("+")]),e("msub",[e("mn",[t._v("0")]),e("mi",[t._v("P")])],1),e("mn",[t._v("0")])],1),e("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("E[R]=79_P79+49_P49+25_P25+0_P0 \n")])],1)],1)],1),t._m(2)])])]),t._v(" "),e("p",[t._v("这里P79为选择79元收费方案的概率,其他类似. 0方案表示用户未选择任何收费方案.这样一来也让概率和为1")]),t._v(" "),e("p",[t._v("下一步是对各个概率值进行估值, 这里不能简单使用Beta/二项分布为各个概率值进行建模,因为他们彼此之间是相关的,他们的和为1. 比如, 如果P79很大, 那么其他的概率必然很小, 所以必须对所有的概率统一建模.")]),t._v(" "),e("p",[t._v("二项分布有一个推广叫做多项分布, 在PyMC和NumPy里都有他. 在下面的代码中,我们用概率数组P来表示各个取值的概率, 如果P的长度为2(并且保证数组和为1),那么此时便得到我们熟悉的二项分布,")]),t._v(" "),t._m(3),e("p",[t._v("回到注册页,我们的观测值服从多项分布,并且各个取值的概率都是未知的.\nBeta分布也有一个推广叫做Dirichlet狄利克雷分布, 他返回一个和为1的正数数组, 数组的长度由一个输入向量的长度决定,这一输入向量的值类似于先验的参数.")]),t._v(" "),t._m(4),e("p",[t._v("luckly, 我们有一个狄利克雷分布与多项分布的关系,类似于Beta分布与二项分布的关系. 狄利克雷分布是多项分布的共轭先验!这意味着对于未知概率的后验, 有明确的公式.如果先验服从于Dirichlet(1,1,1,...1), 并且我们的观测值为N1,N2,N3...Nm, 那么后验是")]),t._v(" "),e("p",[t._v("Dirichlet(1+N1,...1+Nm)")]),t._v(" "),e("p",[t._v("来自该后验的样本的和总是1, 因此可以将这些样本用于前面的期望值的公式里, 让我们用一些样本数据来试试.假如有1000人浏览了页面, 并且注册情况如下:")]),t._v(" "),t._m(5),e("p",[t._v("也可以为这个后验绘制概率密度函数:")]),t._v(" "),e("p",[t._v("for i, label in enumerate(['P_79','P_49','P_25','P_0'])\nax=plt.hist(posterior_samples[:,i], bins=50, label=label, histtype='stepfilled')\nplt.xlabel('Value')\nplt.ylabel('Density')\nplt.title(\"Posterior distributions of the probability of\\selecting different prices\")")]),t._v(" "),e("p",[t._v("plt.legend();")]),t._v(" "),t._m(6),t._v(" "),t._m(7),e("p",[t._v("狄利克雷分布")]),t._v(" "),t._m(8),e("p",[t._v("revenueAB")]),t._v(" "),t._m(9)])}),[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"增加一个线性损失函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#增加一个线性损失函数"}},[this._v("#")]),this._v(" 增加一个线性损失函数")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_1-收入期望的分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-收入期望的分析"}},[this._v("#")]),this._v(" 1 收入期望的分析")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[e("span",{staticClass:"strut",staticStyle:{height:"0.75em"}}),e("span",{staticClass:"strut bottom",staticStyle:{height:"1em","vertical-align":"-0.25em"}}),e("span",{staticClass:"base displaystyle textstyle uncramped"},[e("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.05764em"}},[t._v("E")]),e("span",{staticClass:"mopen"},[t._v("[")]),e("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.00773em"}},[t._v("R")]),e("span",{staticClass:"mclose"},[t._v("]")]),e("span",{staticClass:"mrel"},[t._v("=")]),e("span",{staticClass:"mord mathrm"},[t._v("7")]),e("span",{staticClass:"mord"},[e("span",{staticClass:"mord mathrm"},[t._v("9")]),e("span",{staticClass:"vlist"},[e("span",{staticStyle:{top:"0.15em","margin-right":"0.05em","margin-left":"0em"}},[e("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[e("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),e("span",{staticClass:"reset-textstyle scriptstyle cramped"},[e("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.13889em"}},[t._v("P")])])]),e("span",{staticClass:"baseline-fix"},[e("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[e("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),t._v("​")])])]),e("span",{staticClass:"mord mathrm"},[t._v("7")]),e("span",{staticClass:"mord mathrm"},[t._v("9")]),e("span",{staticClass:"mbin"},[t._v("+")]),e("span",{staticClass:"mord mathrm"},[t._v("4")]),e("span",{staticClass:"mord"},[e("span",{staticClass:"mord mathrm"},[t._v("9")]),e("span",{staticClass:"vlist"},[e("span",{staticStyle:{top:"0.15em","margin-right":"0.05em","margin-left":"0em"}},[e("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[e("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),e("span",{staticClass:"reset-textstyle scriptstyle cramped"},[e("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.13889em"}},[t._v("P")])])]),e("span",{staticClass:"baseline-fix"},[e("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[e("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),t._v("​")])])]),e("span",{staticClass:"mord mathrm"},[t._v("4")]),e("span",{staticClass:"mord mathrm"},[t._v("9")]),e("span",{staticClass:"mbin"},[t._v("+")]),e("span",{staticClass:"mord mathrm"},[t._v("2")]),e("span",{staticClass:"mord"},[e("span",{staticClass:"mord mathrm"},[t._v("5")]),e("span",{staticClass:"vlist"},[e("span",{staticStyle:{top:"0.15em","margin-right":"0.05em","margin-left":"0em"}},[e("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[e("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),e("span",{staticClass:"reset-textstyle scriptstyle cramped"},[e("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.13889em"}},[t._v("P")])])]),e("span",{staticClass:"baseline-fix"},[e("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[e("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),t._v("​")])])]),e("span",{staticClass:"mord mathrm"},[t._v("2")]),e("span",{staticClass:"mord mathrm"},[t._v("5")]),e("span",{staticClass:"mbin"},[t._v("+")]),e("span",{staticClass:"mord"},[e("span",{staticClass:"mord mathrm"},[t._v("0")]),e("span",{staticClass:"vlist"},[e("span",{staticStyle:{top:"0.15em","margin-right":"0.05em","margin-left":"0em"}},[e("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[e("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),e("span",{staticClass:"reset-textstyle scriptstyle cramped"},[e("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.13889em"}},[t._v("P")])])]),e("span",{staticClass:"baseline-fix"},[e("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[e("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),t._v("​")])])]),e("span",{staticClass:"mord mathrm"},[t._v("0")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("from numpy.random import multinomial\nP=[0.5, 0.2, 0.3]\nN=1\nprint multinomial(N,P)\n\nN=10\nprint multinomial(N,P)\n\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("from numpy.random import dirichlet\nsample=dirichlet([1,1])\n\nprint sample\nprint sample.sum()\n\n\nsample=dirichlet([1,1,1,1])\n\nprint sample\nprint sample.sum()\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v('N=1000\nN_79=10\nN_49=46\nN_25=80\nN_0=N-(N_79+N_49+N_25)\n\nobservations=np.array([N_79,N_49,N_25,N_0])\n\nprior_parameters=np.array([1,1,1,1])\n\nposterior_samples=dirichlet(prior_parameters+observations, size=10000)\n\nprint("two random samples from the posterior")\n\nprint posterior_samples[0]\nprint posterior_samples[1]\n\n\n')])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_2-代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-代码"}},[this._v("#")]),this._v(" 2 代码")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v('from numpy.random import multinomial\n\n\nP=[0.5, 0.2, 0.3]\n"""\nP=[0.8,0.2]\n如果P的长度是2,且数组和为1,就是我们熟悉的二项分布   \nP代表一次实验或者一种事件发生的概率\n\nN一个代表实验次数或者潜在事件发生数的一个正整数\n\n\n"""\nN=1\na=P.__len__()\n\nprint (multinomial(N,P))\n\nprint(a)\nN=10\nprint (multinomial(N,P))\n\n\n\nfrom numpy.random import dirichlet\nsample=dirichlet([1,1])\n\nprint (sample)\nprint (sample.sum())\n\n\nsample=dirichlet([1,1,1,1])\n\nprint (sample)\nprint (sample.sum())\n\n')])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("from numpy.random import multinomial\nfrom numpy.random import dirichlet\nimport numpy as np\nfrom matplotlib import pyplot as plt\nfrom scipy.stats import beta\nimport os\nfrom IPython.core.pylabtools import figsize\n\n\n\nN=1000\nN_79=10\nN_49=46\nN_25=80\nN_0=N-(N_79+N_49+N_25)\n\nobservations=np.array([N_79,N_49,N_25,N_0])\n\nprior_parameters=np.array([1,1,1,1])\n\nposterior_samples=dirichlet(prior_parameters+observations, size=10000)\n\nprint(\"two random samples from the posterior\")\n\nprint (posterior_samples[0])\nprint (posterior_samples[1])\n\n'''\ntwo random samples from the posterior\n[0.00930084 0.05811231 0.09153686 0.84104999]\n[0.00724545 0.04749512 0.09477725 0.85048218]\n'''\n\nfor i, label in enumerate(['P_79','P_49','P_25','P_0']):\n    ax=plt.hist(posterior_samples[:,i], bins=50, label=label, histtype='stepfilled')\n\nplt.xlabel('Value')\nplt.ylabel('Density')\nplt.title(\"Posterior distributions of the probability of\\selecting different prices\")\n\nplt.legend()\nplt.show()\nplt.close()\n\n\ndef expected_revenue(P):\n    return 79*P[:,0]+49*P[:,1]+25*P[:,2]+0*P[:,3]\n\nposterior_expected_revenue=expected_revenue(posterior_samples)\nplt.hist(posterior_expected_revenue,histtype='stepfilled',label='expected revenue', bins=50)\n\nplt.xlabel('Value')\nplt.ylabel('Density')\nplt.title(\"Posterior distributions of the expected revenue\")\nplt.legend()\nplt.show()\nplt.close()\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("from numpy.random import multinomial\nfrom numpy.random import dirichlet\nimport numpy as np\nfrom matplotlib import pyplot as plt\nfrom scipy.stats import beta\nimport os\nfrom IPython.core.pylabtools import figsize\n\n\n\nN_A=1000\nN_A_79=10\nN_A_49=46\nN_A_25=80\nN_A_0=N_A-(N_A_79+N_A_49+N_A_25)\n\nobservations_A=np.array([N_A_79,N_A_49,N_A_25,N_A_0])\n\nN_B=2000\nN_B_79=45\nN_B_49=84\nN_B_25=200\nN_B_0=N_B-(N_B_79+N_B_49+N_B_25)\n\nobservations_B=np.array([N_B_79,N_B_49,N_B_25,N_B_0])\n\n\n\ndef expected_revenue(P):\n    return 79*P[:,0]+49*P[:,1]+25*P[:,2]+0*P[:,3]\n\nprior_parameters=np.array([1,1,1,1])\n\nposterior_samples_A=dirichlet(prior_parameters+observations_A, size=10000)\nposterior_samples_B=dirichlet(prior_parameters+observations_B, size=10000)\n\nposterior_expected_revenue_A=expected_revenue(posterior_samples_A)\nposterior_expected_revenue_B=expected_revenue(posterior_samples_B)\nplt.hist(posterior_expected_revenue_A,histtype='stepfilled',label='expected revenue A', bins=50)\nplt.hist(posterior_expected_revenue_B,histtype='stepfilled',label='expected revenue B', bins=50, alpha=0.8)\n\n\n\nplt.xlabel('Value')\nplt.ylabel('Density')\nplt.title(\"Posterior distributions of the expected revenue\\between pages $A$ and $B$\")\n\nplt.legend()\nplt.show()\nplt.close()\n\n\np=(posterior_expected_revenue_B>posterior_expected_revenue_A).mean()\n\nprint(\"页面B比A有更高收入的可能性是:%.3f\"%p)#格式化输出\n'''\n页面B比A有更高收入的可能性是:0.982\n'''\n\n\nposterior_diff=posterior_expected_revenue_B-posterior_expected_revenue_A\n\nplt.hist(posterior_diff,histtype='stepfilled',color='#7A68A6',label='diff in revenue between A and B', bins=50)\n\nplt.xlabel('Value')\nplt.ylabel('Density')\nplt.title(\"Posterior distributions of the delta between pages $A$ and $B$\")\n\nplt.legend()\nplt.show()\nplt.close()\n\n\n")])])])}],!1,null,null,null);s.default=a.exports}}]);