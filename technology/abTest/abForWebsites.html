<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>转化率测试 | CKL</title>
    <meta name="description" content="">
    <link rel="icon" href="/img/logo.jpeg">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    
    <link rel="preload" href="/assets/css/0.styles.77d639ce.css" as="style"><link rel="preload" href="/assets/js/app.76659ae3.js" as="script"><link rel="preload" href="/assets/js/7.7c056201.js" as="script"><link rel="preload" href="/assets/js/6.1a1baeca.js" as="script"><link rel="prefetch" href="/assets/js/10.0524636a.js"><link rel="prefetch" href="/assets/js/11.947c16a3.js"><link rel="prefetch" href="/assets/js/12.51c4984b.js"><link rel="prefetch" href="/assets/js/13.ec23b4a0.js"><link rel="prefetch" href="/assets/js/14.0d704076.js"><link rel="prefetch" href="/assets/js/15.114d913b.js"><link rel="prefetch" href="/assets/js/16.94731e60.js"><link rel="prefetch" href="/assets/js/17.de3739c5.js"><link rel="prefetch" href="/assets/js/18.718702c6.js"><link rel="prefetch" href="/assets/js/19.44ce7a3e.js"><link rel="prefetch" href="/assets/js/2.38932ee6.js"><link rel="prefetch" href="/assets/js/20.95f77a6e.js"><link rel="prefetch" href="/assets/js/21.adc9ee61.js"><link rel="prefetch" href="/assets/js/22.1a4d3107.js"><link rel="prefetch" href="/assets/js/23.ab28b9fb.js"><link rel="prefetch" href="/assets/js/24.f0491f8c.js"><link rel="prefetch" href="/assets/js/25.ebff061e.js"><link rel="prefetch" href="/assets/js/26.fd399e9e.js"><link rel="prefetch" href="/assets/js/27.4634fdc1.js"><link rel="prefetch" href="/assets/js/28.0d72eb05.js"><link rel="prefetch" href="/assets/js/29.e20e7f51.js"><link rel="prefetch" href="/assets/js/3.a3a27c44.js"><link rel="prefetch" href="/assets/js/30.4ef1be23.js"><link rel="prefetch" href="/assets/js/31.af729026.js"><link rel="prefetch" href="/assets/js/32.b74e43bc.js"><link rel="prefetch" href="/assets/js/33.1fc9bd38.js"><link rel="prefetch" href="/assets/js/34.4c884e92.js"><link rel="prefetch" href="/assets/js/35.69ef4130.js"><link rel="prefetch" href="/assets/js/36.f9a6fa95.js"><link rel="prefetch" href="/assets/js/37.d3f2b3c3.js"><link rel="prefetch" href="/assets/js/38.adb7b35e.js"><link rel="prefetch" href="/assets/js/39.ec26ba26.js"><link rel="prefetch" href="/assets/js/4.dd247e61.js"><link rel="prefetch" href="/assets/js/40.3f22cde7.js"><link rel="prefetch" href="/assets/js/41.a85c18e6.js"><link rel="prefetch" href="/assets/js/5.b42ba372.js"><link rel="prefetch" href="/assets/js/8.43850db6.js"><link rel="prefetch" href="/assets/js/9.cb094fa1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.77d639ce.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.jpeg" alt="CKL" class="logo"> <span class="site-name can-hide">CKL</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/technology/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/life/" class="nav-link">生活</a></div><div class="nav-item"><a href="/ponder/" class="nav-link">思考</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签库</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <!----></nav> <div style="display:none;">
   音乐
  <div role="switch" class="el-switch"><input type="checkbox" name="" true-value="true" class="el-switch__input"><!----><span class="el-switch__core" style="width:40px;"></span><!----></div> <audio loop="loop"><source src="/assets/media/yui - you.e3d66957.mp3" type="audio/mpeg"></audio></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/technology/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/life/" class="nav-link">生活</a></div><div class="nav-item"><a href="/ponder/" class="nav-link">思考</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签库</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>转化率测试</span> <!----></p> <ul class="sidebar-group-items"></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="_1-转化率测试的简单重述"><a href="#_1-转化率测试的简单重述" class="header-anchor">#</a> 1 转化率测试的简单重述</h1> <p>假设有A和B两种网站设计,当用户登陆时,我们随机地将其引向其中之一,并且记录下来,当有足够多的用户访问以后,我们用得到的数据计算一些感兴趣的指标,(一般来说,对于网站我们会计算购买和注册情况)</p> <div class="language- extra-class"><pre class="language-text"><code>visitors_to_A=1300
visitors_to_B=1275

conversions_from_A=120
conversions_from_B=125
</code></pre></div><p>我们真正关心的是AB的转化概率, 从商业化的角度,我们希望转化率越高越好,因此我们的目标是找出A和B谁的转化率更高.</p> <p>为此需要对A和B的转化概率进行建模, 由于需要对概率建模,因此选择Beta分布作为先验是个好主意(因为概率的取值范围在0和1之间,刚好与Beta分布对应的值域一致)</p> <p>我们的访客数量和转化数据是二项式的:对于站点A,1300个访客里有120个成功地转化. Beta先验和二项式观测值之间有一个共轭关系,这意味着你不需要进行任何的MCMC.</p> <p>如果我们的先验是Beta(a0,b0),并且我观测的到N次访问里有X次转化,那么此时的后验是Beta(a0+X,b0+N-X). 利用SciPy的内建beta函数,可以直接后验进行采样.</p> <div class="language- extra-class"><pre class="language-text"><code>from scipy.stats import beta
import os

alpha_prior=1
beta_prior=1


posterior_A=beta(alpha_prior+conversions_from_A,beta_prior+visitors_to_A-conversions_from_A)

posterior_B=beta(alpha_prior+conversions_from_B,beta_prior+visitors_to_B-conversions_from_B)


</code></pre></div><p>接下来我们想判断哪个组转化概率可能更高, 为此类似MCMC的做法,我们对后验进行采样,并且比较, 来自于A的后验样本的概率大于来自B的.我们使用rvs方法生成样本</p> <div class="language- extra-class"><pre class="language-text"><code>#用采样来判断哪个组的转化率更高
samples=20000
samples_posterior_A=posterior_A.rvs(samples)
samples_posterior_B=posterior_B.rvs(samples)


#print('dd')
aa=samples_posterior_A
bb=samples_posterior_B
print(aa)
print(bb)
#print((samples_posterior_A &gt; samples_posterior_B).mean()) #注意这里的mean()要在print括号里面

[Output]:0.31355

</code></pre></div><p>所以可以看到,有31%的概率A比B的转化率高,这并不特别显著,如果两个页面完全相同,那么概率会接近50%</p> <p>我们也可以不通过直方图对后验进行可视化分析. 这是通过pdf方法实现的.</p> <div class="language- extra-class"><pre class="language-text"><code>from IPython.core.pylabtools import figsize
from matplotlib import pyplot as plt
import numpy as np


figsize(12.5, 4)

#这里的dpi可以控制图片的大小
plt.rcParams['savefig.dpi']=100
plt.rcParams['figure.dpi']=100

x=np.linspace(0,1,500)
plt.plot(x,posterior_A.pdf(x),label='posterior of A')
plt.plot(x,posterior_B.pdf(x),label='posterior of B')

plt.xlabel('Value')
plt.ylabel('Density')
plt.title(&quot;Posterior of distributions of the conversion rates of Web page $A$ and $B$&quot;)


#给图像加上图例
plt.legend()


</code></pre></div><p><img src="/assets/img/abTest1.fb9ead71.jpg" alt="![Alt text](file_fig/abTest1.jpg)"></p> <p>我们感兴趣的部分放大.</p> <div class="language- extra-class"><pre class="language-text"><code>plt.plot(x,posterior_A.pdf(x),label='posterior of A')
plt.plot(x,posterior_B.pdf(x),label='posterior of B')

plt.xlim(0.05,0.15)

plt.xlabel('Value')
plt.ylabel('Density')
plt.title(&quot;Zoomed-in Posterior distributions of the conversion rates of Web page $A$ and $B$&quot;)


#给图像加上图例
plt.legend()

</code></pre></div><p><img src="/assets/img/abTest2.ee0e0b8f.jpg" alt="![Alt text](file_fig/abTest2.jpg)"></p> <h1 id="_2-具体代码"><a href="#_2-具体代码" class="header-anchor">#</a> 2 具体代码</h1> <div class="language- extra-class"><pre class="language-text"><code>from scipy.stats import beta
import os


alpha_prior=1
beta_prior=1

conversions_from_A=120
conversions_from_B=125

visitors_to_A=1300
visitors_to_B=1275


posterior_A=beta(alpha_prior+conversions_from_A,beta_prior+visitors_to_A-conversions_from_A)
posterior_B=beta(alpha_prior+conversions_from_B,beta_prior+visitors_to_B-conversions_from_B)


'''

#用采样来判断哪个组的转化率更高
samples=20000
samples_posterior_A=posterior_A.rvs(samples)
samples_posterior_B=posterior_B.rvs(samples)


#print('dd')
aa=samples_posterior_A
bb=samples_posterior_B
print(aa)
print(bb)
#print((samples_posterior_A &gt; samples_posterior_B).mean()) #注意这里的mean()要在print括号里面



'''


from IPython.core.pylabtools import figsize
from matplotlib import pyplot as plt
import numpy as np


figure_save_path=&quot;file_fig&quot;

figsize(12.5, 4)

#这里的dpi可以控制图片的大小
plt.rcParams['savefig.dpi']=100
plt.rcParams['figure.dpi']=100

x=np.linspace(0,1,500)

plt.plot(x,posterior_A.pdf(x),label='posterior of A')
plt.plot(x,posterior_B.pdf(x),label='posterior of B')

plt.xlabel('Value')
plt.ylabel('Density')
plt.title(&quot;Posterior distributions of the conversion rates of Web page $A$ and $B$&quot;)


#给图像加上图例
plt.legend()



#保存图片在文件夹
#figure_save_path=&quot;file_fig&quot;
if not os.path.exists(figure_save_path):
    os.makedirs(figure_save_path)

plt.savefig(os.path.join(figure_save_path,'abTest1.jpg'))

plt.show()
plt.close()




'''
# 批量绘制图片,批量存储
for i in range(0,3,1):
    x=[i,1,2,3,4,5]
    y=[0,2,4,6,8,10]
    name_list=[&quot;one&quot;,&quot;two&quot;,&quot;three&quot;]#先创建名字列表，可以是用在图片命名，也可以用在文件夹命名
    plt.plot(x,y)
    # 指定图片保存路径
    figure_save_path = &quot;files_fig_many&quot;#这里创建了一个文件夹，如果依次创建不同文件夹，可以用name_list[i]
    if not os.path.exists(figure_save_path):
        os.makedirs(figure_save_path) # 如果不存在目录figure_save_path，则创建
    plt.savefig(os.path.join(figure_save_path , name_list[i]))#分别命名图片
'''







# 将我们感兴趣的部分放大

plt.plot(x,posterior_A.pdf(x),label='posterior of A')
plt.plot(x,posterior_B.pdf(x),label='posterior of B')

plt.xlim(0.05,0.15)

plt.xlabel('Value')
plt.ylabel('Density')
plt.title(&quot;Zoomed-in Posterior distributions of the conversion rates of Web page $A$ and $B$&quot;)

plt.legend()

if not os.path.exists(figure_save_path):
    os.makedirs(figure_save_path)

plt.savefig(os.path.join(figure_save_path,'abTest2.jpg'))


plt.show() 

#每次展示完图片之后要及时关闭plt,防止图片重复和资源浪费
plt.close()








</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.76659ae3.js" defer></script><script src="/assets/js/7.7c056201.js" defer></script><script src="/assets/js/6.1a1baeca.js" defer></script>
  </body>
</html>
